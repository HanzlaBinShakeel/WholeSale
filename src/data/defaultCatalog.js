export const defaultCollections = [
  {
    id: 101,
    name: 'Gulabi Basant Collection',
    slug: 'bollywood-kurta',
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_7127copy.jpg?v=1743675084',
    enabled: true,
    order: 1
  },
  {
    id: 102,
    name: 'Rang Rass Collection',
    slug: 'indo-western',
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_7140copy.jpg?v=1743674985',
    enabled: true,
    order: 2
  },
  {
    id: 103,
    name: 'Sunheri Collection',
    slug: 'exclusive-kurta',
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2448copy2.jpg?v=1733226350',
    enabled: true,
    order: 3
  },
  {
    id: 104,
    name: 'Jashan Collection',
    slug: 'navratri-special',
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/THE_0689copy2.jpg?v=1691583059',
    enabled: true,
    order: 4
  },
  {
    id: 105,
    name: 'Sitarey Collection',
    slug: 'festive-bandhej',
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/products/DSC_3884copy.jpg?v=1665395344',
    enabled: true,
    order: 5
  },
  {
    id: 106,
    name: 'Sanganeri Print',
    slug: 'wedding-edit',
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_5168copy2.jpg?v=1741090548',
    enabled: true,
    order: 6
  },
  {
    id: 107,
    name: 'Gold Print',
    slug: 'bandhani-saree',
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1856copy3.jpg?v=1711798207',
    enabled: true,
    order: 7
  },
  {
    id: 108,
    name: 'Discharge Print',
    slug: 'premium-cotton-set',
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_8816copy.jpg?v=1729162193',
    enabled: true,
    order: 8
  }
]

export const defaultProducts = [
  {
    id: 1,
    name: 'Premium Black Hand Block Elegant Gold Print Cotton Suit',
    code: 'BSCOTKO08',
    category: 'bandhej',
    subCategory: 'Premium',
    price: 1349,
    moq: 15,
    stock: 'available',
    colors: ['Black Gold', 'Black Beige', 'Black Brown'],
    colorImageMap: {
      'Black Gold': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1682copy2.jpg?v=1685443071',
      'Black Beige': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1682copy21.jpg?v=1685443071',
      'Black Brown': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1682copy22.jpg?v=1685443071'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1682copy2.jpg?v=1685443071',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1682copy2.jpg?v=1685443071',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1682copy21.jpg?v=1685443071',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1682copy22.jpg?v=1685443071'
    ]
  },
  {
    id: 2,
    name: 'Hand Block Elegant Gold Print Cotton Suit With Kota Dupatta',
    code: 'BSCOTKO33',
    category: 'bandhej',
    subCategory: 'Wedding',
    price: 1349,
    moq: 15,
    stock: 'available',
    colors: ['Rose Pink', 'Berry', 'Fuchsia'],
    colorImageMap: {
      'Rose Pink': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1686copy2.jpg?v=1685442942',
      'Berry': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1686copy21.jpg?v=1685442942',
      'Fuchsia': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1686copy22.jpg?v=1685442942'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1686copy2.jpg?v=1685442942',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1686copy2.jpg?v=1685442942',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1686copy21.jpg?v=1685442942',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1686copy22.jpg?v=1685442942'
    ]
  },
  {
    id: 3,
    name: 'Exclusive Hand Block Printed Cotton Suit With Kota Dupatta',
    code: 'BSCOTKO34',
    category: 'bandhej',
    subCategory: 'Premium',
    price: 1349,
    moq: 15,
    stock: 'available',
    colors: ['Navy', 'Slate', 'Blue Grey'],
    colorImageMap: {
      'Navy': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1666copy2.jpg?v=1685443376',
      'Slate': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1666copy21.jpg?v=1685443377',
      'Blue Grey': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1666copy22.jpg?v=1685443376'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1666copy2.jpg?v=1685443376',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1666copy2.jpg?v=1685443376',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1666copy21.jpg?v=1685443377',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_1666copy22.jpg?v=1685443376'
    ]
  },
  {
    id: 4,
    name: 'Premium Bagru Print Maheshwari Silk Suit Set',
    code: 'BSMAHMA24',
    category: 'rajputi-suit',
    subCategory: 'Premium',
    price: 2199,
    moq: 10,
    stock: 'available',
    colors: ['Blue Gold', 'Royal Blue', 'Navy'],
    colorImageMap: {
      'Blue Gold': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/products/DSC06915copyvccopy-min.jpg?v=1648027426',
      'Royal Blue': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/products/DSC06915copyvccopy1-min.jpg?v=1648027426',
      'Navy': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/products/DSC06916-min.jpg?v=1648027426'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/products/DSC06915copyvccopy-min.jpg?v=1648027426',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/products/DSC06915copyvccopy-min.jpg?v=1648027426',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/products/DSC06915copyvccopy1-min.jpg?v=1648027426',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/products/DSC06916-min.jpg?v=1648027426'
    ]
  },
  {
    id: 5,
    name: 'New Brownish Hand Block Printed Cotton Suit With Organza Dupatta',
    code: 'BSCOD31',
    category: 'odhna',
    subCategory: 'Wedding',
    price: 1399,
    moq: 12,
    stock: 'available',
    colors: ['Brown', 'Tan', 'Coffee'],
    colorImageMap: {
      'Brown': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_5283copy3.jpg?v=1695904016',
      'Tan': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_5334copy34_14.jpg?v=1695904023',
      'Coffee': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_5334copy32_14.jpg?v=1695904023'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_5283copy3.jpg?v=1695904016',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_5283copy3.jpg?v=1695904016',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_5334copy34_14.jpg?v=1695904023',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_5334copy32_14.jpg?v=1695904023'
    ]
  },
  {
    id: 6,
    name: 'New Multicolour Hand Block Printed Cotton Suit with Chiffon Dupatta',
    code: 'BSCOTCH10',
    category: 'bandhej',
    subCategory: 'Premium',
    price: 1199,
    moq: 12,
    stock: 'available',
    colors: ['Multicolour', 'Rust', 'Olive'],
    colorImageMap: {
      Multicolour: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_0446copy2.jpg?v=1685447830',
      Rust: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_0446copy22-Copy.jpg?v=1685447832',
      Olive: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_0446copy21.jpg?v=1685447832'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_0446copy2.jpg?v=1685447830',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_0446copy2.jpg?v=1685447830',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_0446copy22-Copy.jpg?v=1685447832',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_0446copy21.jpg?v=1685447832'
    ]
  },
  {
    id: 7,
    name: 'Premium Red and White Tie and Dye Printed Cotton Suit',
    code: 'BSCOTMU83',
    category: 'bandhej',
    subCategory: 'Wedding',
    price: 999,
    moq: 18,
    stock: 'available',
    colors: ['Red White', 'Red', 'Rose'],
    colorImageMap: {
      'Red White': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2335copy.jpg?v=1733221532',
      Red: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2341copy3_10.jpg?v=1733221532',
      Rose: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2339copy2_11.jpg?v=1733221532'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2335copy.jpg?v=1733221532',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2335copy.jpg?v=1733221532',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2341copy3_10.jpg?v=1733221532',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2339copy2_11.jpg?v=1733221532'
    ]
  },
  {
    id: 8,
    name: 'Premium Pink Tie and Dye Print Cotton Suit',
    code: 'BSCOTMU85',
    category: 'bandhej',
    subCategory: 'Wedding',
    price: 999,
    moq: 18,
    stock: 'available',
    colors: ['Pink', 'Magenta', 'Rose Pink'],
    colorImageMap: {
      Pink: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2339copy.jpg?v=1733222129',
      Magenta: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2341copy3_14.jpg?v=1733222129',
      'Rose Pink': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2339copy2_1.jpg?v=1733222129'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2339copy.jpg?v=1733222129',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2339copy.jpg?v=1733222129',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2341copy3_14.jpg?v=1733222129',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2339copy2_1.jpg?v=1733222129'
    ]
  },
  {
    id: 9,
    name: 'Traditional Sanganeri Printed Cotton Suit With Cotton Dupatta',
    code: 'BSCOTMU106',
    category: 'bandhej',
    subCategory: 'Daily',
    price: 1149,
    moq: 20,
    stock: 'available',
    colors: ['Peach', 'Off White', 'Orange'],
    colorImageMap: {
      Peach: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2893copy2.jpg?v=1741253888',
      'Off White': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2894copy22_10.jpg?v=1741253888',
      Orange: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2884copy23_9.jpg?v=1741253888'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2893copy2.jpg?v=1741253888',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2893copy2.jpg?v=1741253888',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2894copy22_10.jpg?v=1741253888',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2884copy23_9.jpg?v=1741253888'
    ]
  },
  {
    id: 10,
    name: 'Traditional Sanganeri Printed Cotton Suit With Cotton Dupatta',
    code: 'BSCOTMU110',
    category: 'bandhej',
    subCategory: 'Daily',
    price: 1149,
    moq: 20,
    stock: 'available',
    colors: ['Ivory', 'Pink', 'Coral'],
    colorImageMap: {
      Ivory: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2904copy3.jpg?v=1741253280',
      Pink: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2895copy33_9.jpg?v=1741253280',
      Coral: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2895copy32_9.jpg?v=1741253280'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2904copy3.jpg?v=1741253280',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2904copy3.jpg?v=1741253280',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2895copy33_9.jpg?v=1741253280',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_2895copy32_9.jpg?v=1741253280'
    ]
  },
  {
    id: 11,
    name: 'Premium Pink and Green Tie and Dye Print Cotton Suit',
    code: 'BSCOTCH71',
    category: 'bandhej',
    subCategory: 'Wedding',
    price: 1299,
    moq: 15,
    stock: 'available',
    colors: ['Pink Green', 'Fuchsia', 'Leaf Green'],
    colorImageMap: {
      'Pink Green': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3051copy.jpg?v=1733309846',
      Fuchsia: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3063copy3_2.jpg?v=1733309845',
      'Leaf Green': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3063copy2_2.jpg?v=1733309846'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3051copy.jpg?v=1733309846',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3051copy.jpg?v=1733309846',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3063copy3_2.jpg?v=1733309845',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3063copy2_2.jpg?v=1733309846'
    ]
  },
  {
    id: 12,
    name: 'Premium Peach Floral Hand Painted Cotton Suit With Chiffon Dupatta',
    code: 'BSCOTCH77',
    category: 'bandhej',
    subCategory: 'Premium',
    price: 1099,
    moq: 15,
    stock: 'available',
    colors: ['Peach', 'Coral Pink', 'Soft Rose'],
    colorImageMap: {
      Peach: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3059copy.jpg?v=1733311182',
      'Coral Pink': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3063copy3_9.jpg?v=1733311182',
      'Soft Rose': 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3063copy2_9.jpg?v=1733311182'
    },
    image: 'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3059copy.jpg?v=1733311182',
    images: [
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3059copy.jpg?v=1733311182',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3063copy3_9.jpg?v=1733311182',
      'https://cdn.shopify.com/s/files/1/0552/5291/0159/files/DSC_3063copy2_9.jpg?v=1733311182'
    ]
  }
]

const isWeakImage = (url = '') =>
  !url ||
  !url.includes('cdn.shopify.com/s/files/1/0552/5291/0159') ||
  url.includes('via.placeholder.com') ||
  url.includes('source.unsplash.com') ||
  url.includes('images.unsplash.com') ||
  url.includes('picsum.photos')

const collectionImageSet = new Set(defaultCollections.map((item) => item.image))

export function normalizeProducts(saved = []) {
  const list = Array.isArray(saved) ? [...saved] : []
  const defaultByCode = new Map(defaultProducts.map((item) => [item.code, item]))
  const savedByCode = new Map(
    list
      .filter((item) => item && item.code && defaultByCode.has(item.code))
      .map((item) => [item.code, item])
  )

  // Keep a stable catalog for storefront so variations always work.
  return defaultProducts.map((fallback, idx) => {
    const item = savedByCode.get(fallback.code) || {}
    const mergedImages = Array.isArray(item.images) ? item.images.filter(Boolean) : []
    const sanitizedImages = mergedImages
      .map((img) => (isWeakImage(img) || collectionImageSet.has(img) ? '' : img))
      .filter(Boolean)
    const images = sanitizedImages.length >= 3 ? sanitizedImages.slice(0, 3) : fallback.images

    const mergedColors = Array.isArray(item.colors) ? item.colors.filter(Boolean) : []
    const colors = mergedColors.length >= 2 ? mergedColors : fallback.colors

    const image = (!isWeakImage(item.image) && !collectionImageSet.has(item.image))
      ? item.image
      : fallback.image

    const colorImageMap = {
      ...fallback.colorImageMap,
      ...(item.colorImageMap || {})
    }

    return {
      ...fallback,
      ...item,
      id: item.id || fallback.id || Date.now() + idx,
      image,
      images,
      colors,
      colorImageMap
    }
  })
}

export function normalizeCollections(saved = []) {
  const list = Array.isArray(saved) ? [...saved] : []
  const defaultBySlug = new Map(defaultCollections.map((item) => [item.slug, item]))
  const savedBySlug = new Map(
    list
      .filter((item) => item && item.slug && defaultBySlug.has(item.slug))
      .map((item) => [item.slug, item])
  )

  // Always keep exactly the 8 curated collection cards with model-wearing visuals.
  return defaultCollections.map((fallback, idx) => {
    const item = savedBySlug.get(fallback.slug) || {}
    return {
      ...fallback,
      ...item,
      id: item.id || fallback.id || Date.now() + idx,
      enabled: true,
      order: item.order || idx + 1,
      image: fallback.image
    }
  })
}
